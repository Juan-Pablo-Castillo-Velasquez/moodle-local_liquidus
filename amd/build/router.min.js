define(["jquery","core/log","core/ajax","core/notification"],function(a,b,c,d){var e=this;return e.trackers=[],e.registerTracker=function(a){b.debug("Registering tracker "+a.trackerInfo.trackerId),e.trackers.push(a),a.identify(),a.trackPage(),a.heartBeat&&setInterval(a.heartBeat,1e4)},e.init=function(){var a=c.call([{methodname:"local_liquidus_event_definition",args:{}}]);a[0].done(function(a){e.addEventTracking(a)}).fail(function(a){d.exception(a)})},e.addEventTracking=function(c){b.debug("Adding event tracking for:"),b.debug(c);for(var d in c){var f=c[d];b.debug("Looking for selector: "+f.testselector),a(f.testselector).length&&e.processDefinition(f)}},e.processDefinition=function(c){b.debug("Adding event handling for custom event: "+c.selector+" -> "+c.event),a(c.selector).on(c.event,function(d){d.preventDefault(),b.debug("Tracking custom event: "+c.selector+" -> "+c.event);var f={};for(var g in c.data){var h=c.data[g];b.debug("Looking for "+h.selector+"value."),"input"===h.type&&(f[h.name]=a(h.selector).val())}b.debug("Got these values:"),b.debug(f);var i=[];for(var j in e.trackers){var k=a.Deferred();i.push(k),e.trackers[j].processEvent(k,c.name,f)}a.when.apply(a,i).then(function(){b.debug("Processed all trackers, proceeding with event."),a(c.selector).off(c.event),a(c.selector).trigger(c.event)})})},{init:e.init,registerTracker:e.registerTracker}});