{"version":3,"sources":["../src/google-lazy.js"],"names":["define","$","Log","Templates","self","tracker","addAnalyticsJS","dfd","Deferred","siteid","trackerInfo","debug","context","render","then","html","append","gtag","fail","resolve","loadTracker","identify","userHash","staticShares","trackPage","plugins","console","log","Object","entries","forEach","key","value","event_label","type","mod","event_category","processEvent","metricName","data"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Loads Segment tracker.\n *\n * @package   local_liquidus\n * @copyright Copyright (c) 2020 Blackboard Inc.\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery','core/log', 'core/templates'],\n    function($, Log, Templates) {\n\n        var self = this;\n\n        var tracker = {};\n\n        self.addAnalyticsJS = function() {\n            var dfd = $.Deferred();\n            var siteid = tracker.trackerInfo.siteid;\n            if (!siteid) {\n                Log.debug('Liquidus is misconfigured for Google, Site ID is missing.');\n                return;\n            }\n            var context = [];\n            context['siteid'] = siteid;\n            Templates.render('local_liquidus/gtag', context).then(function(html) {\n                $('body').append(html);\n                if (typeof gtag === 'undefined') {\n                    dfd.fail();\n                    return;\n                }\n                /* global gtag */\n                self.gtag = gtag;\n                dfd.resolve();\n            });\n\n            return dfd;\n        };\n\n        tracker.loadTracker = function(trackerInfo) {\n            tracker.trackerInfo = trackerInfo;\n            return self.addAnalyticsJS();\n        };\n\n        tracker.identify = function() {\n            Log.debug('Identifying with Google');\n            self.gtag('event', 'identify', {\n                userHash: tracker.trackerInfo.staticShares.userHash\n            });\n        };\n\n        tracker.trackPage = function() {\n            var plugins = tracker.trackerInfo.staticShares.plugins;\n            delete tracker.trackerInfo.staticShares.plugins;\n            console.log(plugins);\n            Object.entries(tracker.trackerInfo.staticShares).forEach(\n                ([key, value]) => {\n                    self.gtag('event', key, {\n                        event_label: value\n                    });\n                }\n            );\n            Object.entries(plugins).forEach(\n                ([type, value]) => {\n                    value.forEach(mod => {\n                        console.log(mod);\n                        self.gtag('event', 'plugin_used_'\n                        + type + '_' + mod, {\n                            event_category: type\n                        });\n                    });\n                });\n        };\n\n        tracker.processEvent = function(dfd, metricName, data) {\n            self.gtag('event', metricName, {\n                'userHash': tracker.trackerInfo.staticShares.userHash,\n                'eventData': data,\n                'event_callback': function() {\n                    dfd.resolve();\n                }\n            });\n        };\n\n        return tracker;\n    });\n"],"file":"google-lazy.min.js"}